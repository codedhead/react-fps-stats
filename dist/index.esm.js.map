{"version":3,"file":"index.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useMemo } from \"react\";\n\ntype Props = {\n  barColor?: string;\n  fontColor?: string;\n  fontSize?: string;\n  capacity: number;\n  paused?: boolean;\n};\n\nconst baseBarColor = \"rgba(0,255,255,1)\";\nconst baseFontColor = \"rgba(0,255,255,1)\";\n\nexport default function FPSStat({ fontColor, fontSize, barColor, capacity, paused }: Props): JSX.Element {\n  const [fpsPointer, setFpsPointer] = useState(0);\n  const fpsPointerRef = useRef(0);\n  const prevTime = useRef(performance.now());\n  const frame = useRef(0);\n  const raf = useRef(0);\n  // const [ctx, setCtx] = useState<CanvasRenderingContext2D|null>(null);\n\n  useEffect(() => {\n    fpsPointerRef.current = fpsPointer;\n  });\n\n  const fpsList = useMemo(() => {\n    const f = new Array(capacity);\n    f.fill(0, 0);\n    return f;\n  }, [capacity]);\n\n  const canvasMain = useRef<HTMLCanvasElement>(null);\n  // const ctx = useMemo(factory, deps) : CanvasRenderingContext2D;\n\n  const calcFPS = () => {\n    const currentTime = performance.now();\n    frame.current = frame.current + 1;\n    if (currentTime > prevTime.current + 1000) {\n      const fpsNow = Math.round((frame.current * 1000) / (currentTime - prevTime.current));\n      fpsList[fpsPointerRef.current] = fpsNow;\n      setFpsPointer((fpsPointerRef.current + 1) % capacity);\n      frame.current = 0;\n      prevTime.current = currentTime;\n    }\n    raf.current = requestAnimationFrame(calcFPS);\n  };\n\n  useEffect(() => {\n    if (!raf.current) {\n      raf.current = requestAnimationFrame(calcFPS);\n    }\n    return () => cancelAnimationFrame(raf.current);\n  }, []);\n\n  useEffect(() => {\n    if (paused) {\n      if (raf.current) {\n        cancelAnimationFrame(raf.current);\n      }\n      raf.current = 0;\n    } else {\n      if (!raf.current) {\n        raf.current = requestAnimationFrame(calcFPS);\n      }\n    }\n  }, [paused]);\n\n  useEffect(() => {\n    const maxFps = Math.max.apply(Math.max, fpsList);\n    if (canvasMain.current) {\n      const ctx = canvasMain.current.getContext(\"2d\");\n      const w = canvasMain.current.width;\n      const h = canvasMain.current.height;\n      if (ctx) {\n        ctx.clearRect(0, 0, w, h);\n        ctx.fillStyle = barColor ? barColor : baseBarColor;\n        for (let i = 0; i < capacity; i++) {\n          const ri = (i - fpsPointer + capacity) % capacity;\n          const rh = fpsList[i] / maxFps;\n          ctx.fillRect((ri * w) / capacity, h * (1 - rh), w / capacity, rh * h);\n        }\n      }\n    }\n  }, [fpsPointer]);\n\n  const wrapperStyle = {\n    zIndex: 100,\n    display: \"flex\",\n    flexDirection: \"column\" as \"column\",\n    height: \"100%\",\n    width: \"100%\",\n    padding: \"3px\",\n    color: fontColor == undefined ? baseFontColor : fontColor,\n    fontSize: fontSize == undefined ? \"0.75em\" : fontSize,\n    fontFamily: \"Helvetica, Arial, sans-serif\",\n    fontWeight: \"bold\" as \"bold\",\n  };\n\n  const canvasStyle = {\n    width: \"100%\",\n    //height: \"100%\",\n  };\n\n  return (\n    <div style={wrapperStyle}>\n      <span style={{ zIndex: 101 }}>{fpsList[(fpsPointer + capacity - 1) % capacity]} FPS</span>\n      <canvas ref={canvasMain} style={canvasStyle}></canvas>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;AAUA,MAAM,YAAY,GAAG,mBAAmB,CAAC;AACzC,MAAM,aAAa,GAAG,mBAAmB,CAAC;SAElB,OAAO,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,EAAS;IACxF,MAAM,CAAC,UAAU,EAAE,aAAa,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;IAChD,MAAM,aAAa,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IAChC,MAAM,QAAQ,GAAG,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC,CAAC;IAC3C,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;IACxB,MAAM,GAAG,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;;IAGtB,SAAS,CAAC;QACR,aAAa,CAAC,OAAO,GAAG,UAAU,CAAC;KACpC,CAAC,CAAC;IAEH,MAAM,OAAO,GAAG,OAAO,CAAC;QACtB,MAAM,CAAC,GAAG,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC9B,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACb,OAAO,CAAC,CAAC;KACV,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;IAEf,MAAM,UAAU,GAAG,MAAM,CAAoB,IAAI,CAAC,CAAC;;IAGnD,MAAM,OAAO,GAAG;QACd,MAAM,WAAW,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC;QACtC,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC;QAClC,IAAI,WAAW,GAAG,QAAQ,CAAC,OAAO,GAAG,IAAI,EAAE;YACzC,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,KAAK,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;YACrF,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACxC,aAAa,CAAC,CAAC,aAAa,CAAC,OAAO,GAAG,CAAC,IAAI,QAAQ,CAAC,CAAC;YACtD,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC;YAClB,QAAQ,CAAC,OAAO,GAAG,WAAW,CAAC;SAChC;QACD,GAAG,CAAC,OAAO,GAAG,qBAAqB,CAAC,OAAO,CAAC,CAAC;KAC9C,CAAC;IAEF,SAAS,CAAC;QACR,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;YAChB,GAAG,CAAC,OAAO,GAAG,qBAAqB,CAAC,OAAO,CAAC,CAAC;SAC9C;QACD,OAAO,MAAM,oBAAoB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAChD,EAAE,EAAE,CAAC,CAAC;IAEP,SAAS,CAAC;QACR,IAAI,MAAM,EAAE;YACV,IAAI,GAAG,CAAC,OAAO,EAAE;gBACf,oBAAoB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;aACnC;YACD,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC;SACjB;aAAM;YACL,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;gBAChB,GAAG,CAAC,OAAO,GAAG,qBAAqB,CAAC,OAAO,CAAC,CAAC;aAC9C;SACF;KACF,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;IAEb,SAAS,CAAC;QACR,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QACjD,IAAI,UAAU,CAAC,OAAO,EAAE;YACtB,MAAM,GAAG,GAAG,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAChD,MAAM,CAAC,GAAG,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC;YACnC,MAAM,CAAC,GAAG,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC;YACpC,IAAI,GAAG,EAAE;gBACP,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBAC1B,GAAG,CAAC,SAAS,GAAG,QAAQ,GAAG,QAAQ,GAAG,YAAY,CAAC;gBACnD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,EAAE,CAAC,EAAE,EAAE;oBACjC,MAAM,EAAE,GAAG,CAAC,CAAC,GAAG,UAAU,GAAG,QAAQ,IAAI,QAAQ,CAAC;oBAClD,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC;oBAC/B,GAAG,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,QAAQ,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;iBACvE;aACF;SACF;KACF,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;IAEjB,MAAM,YAAY,GAAG;QACnB,MAAM,EAAE,GAAG;QACX,OAAO,EAAE,MAAM;QACf,aAAa,EAAE,QAAoB;QACnC,MAAM,EAAE,MAAM;QACd,KAAK,EAAE,MAAM;QACb,OAAO,EAAE,KAAK;QACd,KAAK,EAAE,SAAS,IAAI,SAAS,GAAG,aAAa,GAAG,SAAS;QACzD,QAAQ,EAAE,QAAQ,IAAI,SAAS,GAAG,QAAQ,GAAG,QAAQ;QACrD,UAAU,EAAE,8BAA8B;QAC1C,UAAU,EAAE,MAAgB;KAC7B,CAAC;IAEF,MAAM,WAAW,GAAG;QAClB,KAAK,EAAE,MAAM;KAEd,CAAC;IAEF,QACE,6BAAK,KAAK,EAAE,YAAY;QACtB,8BAAM,KAAK,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE;YAAG,OAAO,CAAC,CAAC,UAAU,GAAG,QAAQ,GAAG,CAAC,IAAI,QAAQ,CAAC;mBAAY;QAC1F,gCAAQ,GAAG,EAAE,UAAU,EAAE,KAAK,EAAE,WAAW,GAAW,CAClD,EACN;AACJ;;;;"}