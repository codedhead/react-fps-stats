{"version":3,"file":"index.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\n\r\ntype Props = {\r\n  barColor?: string;\r\n  fontColor?: string;\r\n  fontSize?: string;\r\n  capacity: number;\r\n};\r\n\r\nconst baseBarColor = \"rgba(0,255,255,1)\";\r\nconst baseFontColor = \"rgba(0,255,255,1)\";\r\n\r\nexport default function FPSStat({ fontColor, fontSize, barColor, capacity }: Props): JSX.Element {\r\n  const [fps, setFps] = useState([0]);\r\n\r\n  const canvasMain = useRef<HTMLCanvasElement>(null);\r\n  //let ctx: CanvasRenderingContext2D;\r\n\r\n  useEffect(() => {\r\n    let afRequest = 0;\r\n    const currentTime = +new Date();\r\n\r\n    let prevTime = currentTime;\r\n    let frame = 0;\r\n    let fpsList = [0];\r\n\r\n    let calcFPS = () => {\r\n      const currentTime = +new Date();\r\n      frame = frame + 1;\r\n\r\n      if (currentTime > prevTime + 1000) {\r\n        let fpsNow = Math.round((frame * 1000) / (currentTime - prevTime));\r\n\r\n        fpsList = fpsList.concat(fpsNow);\r\n\r\n        if (fpsList.length > capacity) {\r\n          fpsList = fpsList.slice(1, capacity + 2);\r\n        }\r\n\r\n        setFps(fpsList);\r\n        //console.log(fpsList);\r\n        frame = 0;\r\n        prevTime = currentTime;\r\n      }\r\n\r\n      afRequest = requestAnimationFrame(calcFPS);\r\n    };\r\n\r\n    afRequest = requestAnimationFrame(calcFPS);\r\n\r\n    return () => {\r\n      cancelAnimationFrame(afRequest);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const maxFps = Math.max.apply(Math.max, fps);\r\n    if (canvasMain.current) {\r\n      const ctx = canvasMain.current.getContext(\"2d\");\r\n      const w = canvasMain.current.width;\r\n      const h = canvasMain.current.height;\r\n      if (ctx) {\r\n        ctx.clearRect(0, 0, w, h);\r\n        ctx.fillStyle = barColor ? barColor : baseBarColor;\r\n        fps.forEach((e, i) => {\r\n          const rh = e / maxFps;\r\n          const ri = capacity - i - 1;\r\n          ctx.fillRect((ri * w) / capacity, h * (1 - rh), w / capacity, rh * h);\r\n        });\r\n      }\r\n    }\r\n  }, [fps]);\r\n\r\n  const wrapperStyle = {\r\n    zIndex: 100,\r\n    display: \"flex\",\r\n    flexDirection: \"column\" as \"column\",\r\n    height: \"100%\",\r\n    width: \"100%\",\r\n    padding: \"3px\",\r\n    color: fontColor == undefined ? baseFontColor : fontColor,\r\n    fontSize: fontSize == undefined ? \"0.75em\" : fontSize,\r\n    fontFamily: \"Helvetica, Arial, sans-serif\",\r\n    fontWeight: \"bold\" as \"bold\",\r\n  };\r\n\r\n  const canvasStyle = {\r\n    width: \"100%\",\r\n    //height: \"100%\",\r\n  };\r\n\r\n  return (\r\n    <div style={wrapperStyle}>\r\n      <span style={{ zIndex: 101 }}>{fps[fps.length - 1]} FPS</span>\r\n      <canvas ref={canvasMain} style={canvasStyle}></canvas>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}